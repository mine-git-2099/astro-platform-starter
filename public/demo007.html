<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¹¿è¥¿å·¥ä¼šè¯å“å•†åŸ</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 750px;
            margin: 0 auto;
            padding-bottom: 60px; /* ä¸ºåº•éƒ¨å¯¼èˆªç•™å‡ºç©ºé—´ */
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-right: 10px;
        }
        
        .login-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .search-box {
            background: white;
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
        }
        
        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            margin-left: 5px;
            font-size: 14px;
        }
        
        /* å¯¼èˆªæ ·å¼ */
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 0;
            background: white;
            border-bottom: 1px solid #eee;
        }
        
        .nav-tab {
            padding: 5px 15px;
            margin: 0 5px;
            border-radius: 15px;
            background: #f5f5f5;
            font-size: 14px;
        }
        
        .nav-tab.active {
            background: #e74c3c;
            color: white;
        }
        
        /* å†…å®¹åŒºåŸŸæ ·å¼ */
        .content {
            padding: 15px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin: 15px 0 10px;
            color: #333;
        }
        
        /* è¯å“å¡ç‰‡æ ·å¼ */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .product-img {
            width: 100%;
            height: 120px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        
        .product-info {
            padding: 10px;
        }
        
        .product-name {
            font-size: 14px;
            margin-bottom: 5px;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .original-price {
            color: #999;
            text-decoration: line-through;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .member-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 16px;
        }
        
        .points-info {
            color: #e74c3c;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .add-to-cart {
            background: #e74c3c;
            color: white;
            border: none;
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* åº•éƒ¨å¯¼èˆªæ ·å¼ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #eee;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #666;
        }
        
        .nav-item.active {
            color: #e74c3c;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 15px;
            background: #e74c3c;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
        }
        
        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-form {
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .submit-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        /* è´­ç‰©è½¦æ ·å¼ */
        .cart-item {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item-img {
            width: 60px;
            height: 60px;
            background: #f0f0f0;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .cart-item-price {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
        }
        
        .quantity-btn {
            width: 25px;
            height: 25px;
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity {
            margin: 0 10px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç™»å½•å·¥ä¼šè´¦å·</h3>
                <button class="close-btn" onclick="closeModal('loginModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="login-form">
                    <div class="form-group">
                        <label for="username">è´¦å·</label>
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥è´¦å·">
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    <button class="submit-btn" onclick="login()">ç™»å½•</button>
                    <div style="margin-top: 15px; font-size: 12px; color: #666;">
                        <p>æµ‹è¯•è´¦å·ï¼š</p>
                        <p>ä¼šå‘˜è´¦å·ï¼šuser1 (å¯†ç ä»»æ„)</p>
                        <p>éä¼šå‘˜è´¦å·ï¼šuser2 (å¯†ç ä»»æ„)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header>
            <div class="header-top">
                <div class="logo">å¹¿è¥¿å·¥ä¼šè¯å“å•†åŸ</div>
                <div class="user-info">
                    <span id="userStatus">æœªç™»å½•</span>
                    <button class="login-btn" onclick="openModal('loginModal')">ç™»å½•</button>
                </div>
            </div>
            <div class="search-box">
                <span>ğŸ”</span>
                <input type="text" placeholder="æœç´¢è¯å“åç§°">
            </div>
        </header>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="nav-tabs">
            <div class="nav-tab active">æ¨è</div>
            <div class="nav-tab">æ„Ÿå†’ç”¨è¯</div>
            <div class="nav-tab">ç»´ç”Ÿç´ </div>
            <div class="nav-tab">å„¿ç§‘ç”¨è¯</div>
            <div class="nav-tab">è‚ èƒƒç”¨è¯</div>
            <div class="nav-tab">çš®è‚¤ç”¨è¯</div>
            <div class="nav-tab">å¿ƒè„‘è¡€ç®¡</div>
        </div>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- ä¸ªæ€§åŒ–æ¨è -->
            <h3 class="section-title">ä¸ºæ‚¨æ¨è</h3>
            <div class="product-grid" id="recommendedProducts">
                <!-- æ¨èå•†å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- çƒ­é—¨å•†å“ -->
            <h3 class="section-title">çƒ­é—¨è¯å“</h3>
            <div class="product-grid" id="hotProducts">
                <!-- çƒ­é—¨å•†å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav">
            <div class="nav-item active">
                <div class="nav-icon">ğŸ </div>
                <span>é¦–é¡µ</span>
            </div>
            <div class="nav-item" onclick="openModal('categoryModal')">
                <div class="nav-icon">ğŸ“‚</div>
                <span>åˆ†ç±»</span>
            </div>
            <div class="nav-item" onclick="openCart()">
                <div class="nav-icon">ğŸ›’</div>
                <span>è´­ç‰©è½¦</span>
            </div>
            <div class="nav-item" onclick="openModal('orderModal')">
                <div class="nav-icon">ğŸ“‹</div>
                <span>è®¢å•</span>
            </div>
            <div class="nav-item" onclick="openModal('serviceModal')">
                <div class="nav-icon">ğŸ’¬</div>
                <span>å®¢æœ</span>
            </div>
        </div>
    </div>

    <!-- åˆ†ç±»æ¨¡æ€æ¡† -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è¯å“åˆ†ç±»</h3>
                <button class="close-btn" onclick="closeModal('categoryModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="search-box" style="margin-bottom: 15px;">
                    <span>ğŸ”</span>
                    <input type="text" placeholder="æœç´¢è¯å“åç§°">
                </div>
                <div id="categoryList">
                    <!-- åˆ†ç±»åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- è´­ç‰©è½¦æ¨¡æ€æ¡† -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è´­ç‰©è½¦</h3>
                <button class="close-btn" onclick="closeModal('cartModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="cartItems">
                    <!-- è´­ç‰©è½¦å•†å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div id="cartTotal" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                    <!-- è´­ç‰©è½¦æ€»è®¡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button class="submit-btn" style="width: 100%; margin-top: 15px;" onclick="checkout()">å»ç»“ç®—</button>
            </div>
        </div>
    </div>

    <!-- è®¢å•æ¨¡æ€æ¡† -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æˆ‘çš„è®¢å•</h3>
                <button class="close-btn" onclick="closeModal('orderModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="orderList">
                    <!-- è®¢å•åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- å®¢æœæ¨¡æ€æ¡† -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åœ¨çº¿å®¢æœ</h3>
                <button class="close-btn" onclick="closeModal('serviceModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 15px;">
                    <button class="nav-tab" style="margin-right: 10px;" onclick="switchService('ai')">AIå®¢æœ</button>
                    <button class="nav-tab" onclick="switchService('human')">äººå·¥å®¢æœ</button>
                </div>
                <div id="serviceContent">
                    <!-- å®¢æœå†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®
        const products = [
            { id: 1, name: "æ„Ÿå†’çµé¢—ç²’", category: "æ„Ÿå†’ç”¨è¯", price: 25.8, memberPrice: 22.5, image: "æ„Ÿå†’è¯", isPrescription: false },
            { id: 2, name: "ç»´ç”Ÿç´ Cç‰‡", category: "ç»´ç”Ÿç´ ", price: 35.0, memberPrice: 30.0, image: "ç»´ç”Ÿç´ ", isPrescription: false },
            { id: 3, name: "å„¿ç«¥é€€çƒ§è¯", category: "å„¿ç§‘ç”¨è¯", price: 28.5, memberPrice: 25.0, image: "å„¿ç§‘è¯", isPrescription: false },
            { id: 4, name: "èƒƒåº·çµèƒ¶å›Š", category: "è‚ èƒƒç”¨è¯", price: 42.0, memberPrice: 38.0, image: "è‚ èƒƒè¯", isPrescription: false },
            { id: 5, name: "çš®ç‚å¹³è½¯è†", category: "çš®è‚¤ç”¨è¯", price: 18.5, memberPrice: 16.0, image: "çš®è‚¤è¯", isPrescription: false },
            { id: 6, name: "é™å‹è¯", category: "å¿ƒè„‘è¡€ç®¡", price: 65.0, memberPrice: 58.0, image: "å¿ƒè„‘è¡€ç®¡è¯", isPres: true }
        ];

        const categories = [
            { id: 1, name: "æ„Ÿå†’ç”¨è¯", subcategories: ["æ„Ÿå†’è¯", "æ­¢å’³åŒ–ç—°", "é€€çƒ§è¯"] },
            { id: 2, name: "ç»´ç”Ÿç´ ", subcategories: ["ç»´ç”Ÿç´ C", "ç»´ç”Ÿç´ B", "å¤åˆç»´ç”Ÿç´ "] },
            { id: 3, name: "å„¿ç§‘ç”¨è¯", subcategories: ["é€€çƒ§è¯", "æ„Ÿå†’è¯", "æ¶ˆåŒ–è¯"] },
            { id: 4, name: "è‚ èƒƒç”¨è¯", subcategories: ["èƒƒè¯", "è‚ é“è¯", "æ¶ˆåŒ–è¯"] },
            { id: 5, name: "çš®è‚¤ç”¨è¯", subcategories: ["çš®ç‚è¯", "æ¹¿ç–¹è¯", "ç—¤ç–®è¯"] },
            { id: 6, name: "å¿ƒè„‘è¡€ç®¡", subcategories: ["é™å‹è¯", "é™è„‚è¯", "å¿ƒè„ç—…è¯"] }
        ];

        // ç”¨æˆ·çŠ¶æ€
        let user = {
            isLoggedIn: false,
            isMember: false,
            points: 0,
            cart: [],
            orders: []
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            renderProducts();
            renderCategories();
            updateCartCount();
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('pharmacyUser');
            if (savedUser) {
                user = JSON.parse(savedUser);
                updateUserDisplay();
            } else {
                openModal('loginModal');
            }
        }

        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        function updateUserDisplay() {
            const userStatus = document.getElementById('userStatus');
            if (user.isLoggedIn) {
                userStatus.textContent = user.isMember ? 'ä¼šå‘˜ç”¨æˆ·' : 'æ™®é€šç”¨æˆ·';
                if (user.isMember) {
                    userStatus.innerHTML += ` <span style="font-size:12px;">(ç§¯åˆ†: ${user.points})</span>`;
                }
            } else {
                userStatus.textContent = 'æœªç™»å½•';
            }
            
            // é‡æ–°æ¸²æŸ“äº§å“ä»¥æ˜¾ç¤ºæ­£ç¡®çš„ä»·æ ¼
            renderProducts();
        }

        // ç™»å½•åŠŸèƒ½
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username) {
                alert('è¯·è¾“å…¥è´¦å·');
                return;
            }
            
            // æ¨¡æ‹Ÿç™»å½•éªŒè¯
            user.isLoggedIn = true;
            user.isMember = (username === 'user1');
            user.points = user.isMember ? 500 : 0;
            user.cart = user.cart || [];
            user.orders = user.orders || [];
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('pharmacyUser', JSON.stringify(user));
            
            closeModal('loginModal');
            updateUserDisplay();
            alert(`ç™»å½•æˆåŠŸï¼${user.isMember ? 'æ‚¨æ˜¯ä¼šå‘˜ç”¨æˆ·ï¼Œäº«æœ‰ä¼šå‘˜ä»·å’Œç§¯åˆ†æŠµæ‰£' : 'æ‚¨æ˜¯æ™®é€šç”¨æˆ·'}`);
        }

        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            
            if (modalId === 'cartModal') {
                renderCart();
            } else if (modalId === 'orderModal') {
                renderOrders();
            } else if (modalId === 'serviceModal') {
                switchService('ai');
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // æ¸²æŸ“äº§å“
        function renderProducts() {
            const recommendedProducts = document.getElementById('recommendedProducts');
            const hotProducts = document.getElementById('hotProducts');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            recommendedProducts.innerHTML = '';
            hotProducts.innerHTML = '';
            
            // æ¨¡æ‹Ÿä¸ªæ€§åŒ–æ¨èï¼ˆæ ¹æ®ç”¨æˆ·çŠ¶æ€ï¼‰
            let recommended = [];
            if (user.isLoggedIn && user.isMember) {
                // ä¼šå‘˜æ¨è
                recommended = products.filter(p => p.category === "ç»´ç”Ÿç´ " || p.category === "å¿ƒè„‘è¡€ç®¡");
            } else {
                // éä¼šå‘˜æˆ–æœªç™»å½•æ¨è
                recommended = products.filter(p => p.category === "æ„Ÿå†’ç”¨è¯" || p.category === "å„¿ç§‘ç”¨è¯");
            }
            
            // æ¸²æŸ“æ¨èäº§å“
            recommended.forEach(product => {
                recommendedProducts.appendChild(createProductCard(product));
            });
            
            // æ¸²æŸ“çƒ­é—¨äº§å“ï¼ˆæ‰€æœ‰äº§å“ï¼‰
            products.forEach(product => {
                hotProducts.appendChild(createProductCard(product));
            });
        }

        // åˆ›å»ºäº§å“å¡ç‰‡
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            card.innerHTML = `
                <div class="product-img">${product.image}</div>
                <div class="product-info">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">
                        <span class="original-price">Â¥${product.price.toFixed(2)}</span>
                        ${user.isLoggedIn && user.isMember ? `<span class="member-price">ä¼šå‘˜ä»·: Â¥${product.memberPrice.toFixed(2)}</span>` : ''}
                    </div>
                    ${user.isLoggedIn && user.isMember ? `<div class="points-info">æœ€å¤šå¯æŠµæ‰£: Â¥${(product.memberPrice * 0.5).toFixed(2)}</div>` : ''}
                    <button class="add-to-cart" onclick="addToCart(${product.id})">åŠ å…¥è´­ç‰©è½¦</button>
                </div>
            `;
            
            return card;
        }

        // æ¸²æŸ“åˆ†ç±»
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.innerHTML = `
                    <div style="padding: 10px 0; border-bottom: 1px solid #eee;">
                        <div style="font-weight: bold; margin-bottom: 5px;">${category.name}</div>
                        <div style="font-size: 12px; color: #666;">
                            ${category.subcategories.map(sub => `<span style="display: inline-block; padding: 3px 8px; background: #f0f0f0; border-radius: 10px; margin-right: 5px; margin-bottom: 5px;">${sub}</span>`).join('')}
                        </div>
                    </div>
                `;
                categoryList.appendChild(categoryItem);
            });
        }

        // æ·»åŠ åˆ°è´­ç‰©è½¦
        function addToCart(productId) {
            if (!user.isLoggedIn) {
                openModal('loginModal');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            const existingItem = user.cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                user.cart.push({
                    id: product.id,
                    name: product.name,
                    price: user.isMember ? product.memberPrice : product.price,
                    quantity: 1,
                    isPrescription: product.isPrescription
                });
            }
            
            // æ›´æ–°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('pharmacyUser', JSON.stringify(user));
            
            updateCartCount();
            alert('å·²æ·»åŠ åˆ°è´­ç‰©è½¦');
        }

        // æ›´æ–°è´­ç‰©è½¦æ•°é‡æ˜¾ç¤º
        function updateCartCount() {
            const cartCount = document.querySelector('.nav-item:nth-child(3)');
            const count = user.cart.reduce((total, item) => total + item.quantity, 0);
            
            if (count > 0) {
                cartCount.innerHTML = `
                    <div class="nav-icon">ğŸ›’<span style="position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 10px; display: flex; align-items: center; justify-content: center;">${count}</span></div>
                    <span>è´­ç‰©è½¦</span>
                `;
            } else {
                cartCount.innerHTML = `
                    <div class="nav-icon">ğŸ›’</div>
                    <span>è´­ç‰©è½¦</span>
                `;
            }
        }

        // æ‰“å¼€è´­ç‰©è½¦
        function openCart() {
            if (!user.isLoggedIn) {
                openModal('loginModal');
                return;
            }
            
            openModal('cartModal');
        }

        // æ¸²æŸ“è´­ç‰©è½¦
        function renderCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            cartItems.innerHTML = '';
            
            if (user.cart.length === 0) {
                cartItems.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">è´­ç‰©è½¦ä¸ºç©º</div>';
                cartTotal.innerHTML = '';
                return;
            }
            
            let total = 0;
            user.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-img">${item.name.substring(0, 2)}</div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">Â¥${item.price.toFixed(2)} Ã— ${item.quantity} = Â¥${itemTotal.toFixed(2)}</div>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            // è®¡ç®—ç§¯åˆ†æŠµæ‰£
            let pointsDeduction = 0;
            if (user.isMember) {
                const maxDeduction = total * 0.5; // æœ€å¤šæŠµæ‰£50%
                const pointsValue = user.points / 10; // 10ç§¯åˆ†=1å…ƒ
                pointsDeduction = Math.min(maxDeduction, pointsValue);
            }
            
            const finalTotal = total - pointsDeduction;
            
            cartTotal.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>å•†å“æ€»é¢:</span>
                    <span>Â¥${total.toFixed(2)}</span>
                </div>
                ${user.isMember ? `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ç§¯åˆ†æŠµæ‰£ (${user.points}ç§¯åˆ†):</span>
                    <span>-Â¥${pointsDeduction.toFixed(2)}</span>
                </div>
                ` : ''}
                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px;">
                    <span>åº”ä»˜é‡‘é¢:</span>
                    <span style="color: #e74c3c;">Â¥${finalTotal.toFixed(2)}</span>
                </div>
            `;
        }

        // æ›´æ–°è´­ç‰©è½¦å•†å“æ•°é‡
        function updateQuantity(productId, change) {
            const item = user.cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                
                if (item.quantity <= 0) {
                    user.cart = user.cart.filter(item => item.id !== productId);
                }
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('pharmacyUser', JSON.stringify(user));
                
                updateCartCount();
                renderCart();
            }
        }

        // ç»“ç®—
        function checkout() {
            if (user.cart.length === 0) {
                alert('è´­ç‰©è½¦ä¸ºç©º');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å¤„æ–¹è¯
            const hasPrescription = user.cart.some(item => item.isPrescription);
            
            if (hasPrescription) {
                // å¦‚æœæœ‰å¤„æ–¹è¯ï¼Œæ˜¾ç¤ºè¡¥æ–¹é¡µé¢
                openPrescriptionModal();
            } else {
                // ç›´æ¥è¿›å…¥æ”¯ä»˜é¡µé¢
                openPaymentModal();
            }
        }

        // æ‰“å¼€è¡¥æ–¹æ¨¡æ€æ¡†
        function openPrescriptionModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>å¤„æ–¹è¯è¡¥å……ä¿¡æ¯</h3>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <p>æ‚¨è´­ä¹°çš„è¯å“ä¸­åŒ…å«å¤„æ–¹è¯ï¼Œéœ€è¦åŒ»ç”Ÿå¼€å…·ç”µå­å¤„æ–¹ã€‚</p>
                        <div style="margin: 15px 0;">
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="checkbox" id="health1"> æˆ‘ç¡®è®¤æ— è¯ç‰©è¿‡æ•å²
                            </label>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="checkbox" id="health2"> æˆ‘ç¡®è®¤æ— ä¸¥é‡è‚è‚¾ç–¾ç—…
                            </label>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="checkbox" id="health3"> æˆ‘ç¡®è®¤è¿‘æœŸæœªæœç”¨ç±»ä¼¼è¯ç‰©
                            </label>
                        </div>
                        <button class="submit-btn" onclick="submitPrescription()">æäº¤ä¿¡æ¯ï¼Œè·å–ç”µå­å¤„æ–¹</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // æäº¤å¤„æ–¹ä¿¡æ¯
        function submitPrescription() {
            const health1 = document.getElementById('health1').checked;
            const health2 = document.getElementById('health2').checked;
            const health3 = document.getElementById('health3').checked;
            
            if (!health1 || !health2 || !health3) {
                alert('è¯·ç¡®è®¤æ‰€æœ‰å¥åº·ä¿¡æ¯');
                return;
            }
            
            // æ¨¡æ‹ŸåŒ»ç”Ÿå¼€å…·å¤„æ–¹
            alert('ç”µå­å¤„æ–¹å·²å¼€å…·ï¼Œè¯·ç»§ç»­æ”¯ä»˜');
            document.querySelector('.modal:last-child').remove();
            openPaymentModal();
        }

        // æ‰“å¼€æ”¯ä»˜æ¨¡æ€æ¡†
        function openPaymentModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ”¯ä»˜è®¢å•</h3>
                        <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <p>è®¢å•æ€»é‡‘é¢: Â¥${calculateTotal().toFixed(2)}</p>
                        <div style="margin: 15px 0;">
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="payment" value="wechat" checked> å¾®ä¿¡æ”¯ä»˜
                            </label>
                            <label style="display: block; margin-bottom: 10px;">
                                <input type="radio" name="payment" value="alipay"> æ”¯ä»˜å®
                            </label>
                        </div>
                        <button class="submit-btn" onclick="processPayment()">ç«‹å³æ”¯ä»˜</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // è®¡ç®—è®¢å•æ€»é‡‘é¢
        function calculateTotal() {
            let total = user.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            if (user.isMember) {
                const maxDeduction = total * 0.5;
                const pointsValue = user.points / 10;
                const pointsDeduction = Math.min(maxDeduction, pointsValue);
                total -= pointsDeduction;
            }
            
            return total;
        }

        // å¤„ç†æ”¯ä»˜
        function processPayment() {
            // æ¨¡æ‹Ÿæ”¯ä»˜è¿‡ç¨‹
            setTimeout(() => {
                // åˆ›å»ºè®¢å•
                const order = {
                    id: Date.now(),
                    items: [...user.cart],
                    total: calculateTotal(),
                    status: 'å·²å®Œæˆ',
                    date: new Date().toLocaleDateString(),
                    tracking: 'SF1234567890'
                };
                
                user.orders.push(order);
                user.cart = [];
                
                // å¦‚æœæ˜¯ä¼šå‘˜ï¼Œæ‰£é™¤ä½¿ç”¨çš„ç§¯åˆ†
                if (user.isMember) {
                    const pointsUsed = Math.min(user.points, calculateTotal() * 10);
                    user.points -= pointsUsed;
                }
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('pharmacyUser', JSON.stringify(user));
                
                updateCartCount();
                
                // å…³é—­æ”¯ä»˜æ¨¡æ€æ¡†
                document.querySelector('.modal:last-child').remove();
                closeModal('cartModal');
                
                alert('æ”¯ä»˜æˆåŠŸï¼è®¢å•å·: ' + order.id);
            }, 1000);
        }

        // æ¸²æŸ“è®¢å•
        function renderOrders() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            
            if (user.orders.length === 0) {
                orderList.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">æš‚æ— è®¢å•</div>';
                return;
            }
            
            user.orders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.style.padding = '10px 0';
                orderItem.style.borderBottom = '1px solid #eee';
                
                orderItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>è®¢å•å·: ${order.id}</span>
                        <span style="color: #e74c3c;">${order.status}</span>
                    </div>
                    <div style="margin-bottom: 5px;">æ—¥æœŸ: ${order.date}</div>
                    <div style="margin-bottom: 5px;">æ€»é‡‘é¢: Â¥${order.total.toFixed(2)}</div>
                    <div style="font-size: 12px; color: #666;">
                        ${order.items.map(item => `${item.name} Ã— ${item.quantity}`).join(', ')}
                    </div>
                    ${order.tracking ? `<div style="margin-top: 5px; font-size: 12px;">ç‰©æµ: ${order.tracking}</div>` : ''}
                `;
                
                orderList.appendChild(orderItem);
            });
        }

        // åˆ‡æ¢å®¢æœç±»å‹
        function switchService(type) {
            const serviceContent = document.getElementById('serviceContent');
            
            if (type === 'ai') {
                serviceContent.innerHTML = `
                    <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <strong>AIå®¢æœ:</strong> æ‚¨å¥½ï¼Œæˆ‘æ˜¯AIå®¢æœï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="nav-tab" style="text-align: left;" onclick="aiResponse('é€€è´§æ”¿ç­–')">é€€è´§æ”¿ç­–æ˜¯ä»€ä¹ˆï¼Ÿ</button>
                        <button class="nav-tab" style="text-align: left;" onclick="aiResponse('å‘ç¥¨ç”³è¯·')">å¦‚ä½•ç”³è¯·å‘ç¥¨ï¼Ÿ</button>
                        <button class="nav-tab" style="text-align: left;" onclick="aiResponse('ä¼šå‘˜æƒç›Š')">ä¼šå‘˜æœ‰å“ªäº›æƒç›Šï¼Ÿ</button>
                    </div>
                `;
            } else {
                serviceContent.innerHTML = `
                    <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <strong>äººå·¥å®¢æœ:</strong> æ‚¨å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ
                    </div>
                    <div style="text-align: center; padding: 20px; color: #999;">
                        äººå·¥å®¢æœå·¥ä½œæ—¶é—´: 9:00-18:00<br>
                        è¯·ç¨åï¼Œå®¢æœå°†å°½å¿«ä¸ºæ‚¨æœåŠ¡
                    </div>
                `;
            }
        }

        // AIå®¢æœå›å¤
        function aiResponse(question) {
            let response = '';
            
            switch(question) {
                case 'é€€è´§æ”¿ç­–':
                    response = 'è¯å“å±äºç‰¹æ®Šå•†å“ï¼Œéè´¨é‡é—®é¢˜ä¸æ”¯æŒé€€è´§ã€‚å¦‚æœ‰è´¨é‡é—®é¢˜ï¼Œè¯·åœ¨æ”¶åˆ°å•†å“å7å¤©å†…è”ç³»å®¢æœå¤„ç†ã€‚';
                    break;
                case 'å‘ç¥¨ç”³è¯·':
                    response = 'æ‚¨å¯ä»¥åœ¨è®¢å•å®Œæˆåï¼Œåœ¨è®¢å•è¯¦æƒ…é¡µé¢ç”³è¯·å¼€å…·ç”µå­å‘ç¥¨ã€‚å‘ç¥¨å°†åœ¨3ä¸ªå·¥ä½œæ—¥å†…å‘é€åˆ°æ‚¨çš„é‚®ç®±ã€‚';
                    break;
                case 'ä¼šå‘˜æƒç›Š':
                    response = 'ä¼šå‘˜äº«æœ‰ä¸“å±ä»·æ ¼å’Œç§¯åˆ†æŠµæ‰£æƒç›Šã€‚ç§¯åˆ†è§„åˆ™ï¼š10ç§¯åˆ†=1å…ƒï¼Œæœ€å¤šå¯æŠµæ‰£å•†å“ä»·æ ¼çš„50%ã€‚';
                    break;
                default:
                    response = 'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨çš„é—®é¢˜ï¼Œè¯·å°è¯•å…¶ä»–é—®é¢˜æˆ–è½¬æ¥äººå·¥å®¢æœã€‚';
            }
            
            const serviceContent = document.getElementById('serviceContent');
            serviceContent.innerHTML += `
                <div style="background: #e0f0ff; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <strong>æ‚¨:</strong> ${question}
                </div>
                <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-top: 5px;">
                    <strong>AIå®¢æœ:</strong> ${response}
                </div>
            `;
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            serviceContent.scrollTop = serviceContent.scrollHeight;
        }
    </script>
</body>
</html>
